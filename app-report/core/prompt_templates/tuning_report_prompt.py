# 뉴스 생성 프롬프트 템플릿

from ...schemas.tuning_schema import UserProfile


def build_prompt(
    category: str, chatCount: int, userA: UserProfile, userB: UserProfile
) -> str:
    def format_list(items: list[str]) -> str:
        return ", ".join(items) if items else "없음"

    def format_user(user: UserProfile, label: str) -> str:
        return (
            f"🔹 {label}\n"
            f" - 성별: {user.gender}\n"
            f" - MBTI: {user.MBTI}\n"
            f" - 종교: {user.religion}\n"
            f" - 흡연: {user.smoking}\n"
            f" - 음주: {user.drinking}\n"
            f" - 성향: {format_list(user.personality)}\n"
            f" - 선호하는 사람 유형: {format_list(user.preferredPeople)}\n"
            f" - 관심사: {format_list(user.currentInterests)}\n"
            f" - 좋아하는 음식: {format_list(user.favoriteFoods)}\n"
            f" - 좋아하는 운동: {format_list(user.likedSports)}\n"
            f" - 반려동물: {format_list(user.pets)}\n"
            f" - 자기계발 활동: {format_list(user.selfDevelopment)}\n"
            f" - 취미: {format_list(user.hobbies)}"
        )

    if category == "COUPLE":
        # 커플
        style_guide = (
            "✅ 가십/연예 뉴스 스타일\n"
            "✅ 의문문과 감탄문 사용\n"
            "✅ 호기심을 자극하는 어조\n"
            "✅ 청춘 드라마처럼 위트 있게\n"
            "✅ 독자에게 직접 말하듯 친근하게\n"
            "✅ 밝고 경쾌한 톤\n"
        )
        few_shot1 = (
            '{"title": "💘 정반대에서 피어난 케미?! ISTJ와 ENFP의 반전 매치!",\n'
            '"content": "어느 날, 전혀 다른 두 사람이 연결되었습니다. 계획적인 사람과 자유로운 영혼… 과연 이 조합, 통할 수 있을까요? 🤔💞\n\n'
            "MBTI 궁합 힌트! ISTJ의 신중함과 ENFP의 활발함이 만나면, 하나의 일상이 모험으로?! 서로의 세계를 넓혀주는 조합일지도 몰라요! 🌏✨\n\n"
            "공통 관심사는 다정한 일상: 둘 다 요리를 좋아하고 반려동물과 시간을 보내는 걸 즐긴다고?! 혹시 같이 강아지 간식 만들기 클래스? 🐶🍪\n\n"
            "벌써 42번의 대화를 주고받은 이 커플! 처음엔 어색했지만, 이제는 하루가 다르게 가까워지는 중이라는데… 혹시 주말 데이트 약속도 잡혔을까요?! 💬❤️\\n\\n"
            '이 연결, 단순한 우연일까요? 혹은 인연의 시작일까요? Stay Tuned!💌"}\n'
        )
        few_shot2 = (
            '{"title": "🎬 조용한 감성 러브라인?! INFP와 ISFJ의 은근한 설렘!",\n'
            '"content": "첫 번째 힌트! INFP와 ISFJ의 만남, 말수는 적지만 눈빛 하나로 통하는 그 감정선! 조용히 서로를 알아가는 분위기, 혹시 썸인가요? 🫣💘\n\n'
            "두 번째 힌트! 둘 다 베이킹과 식물 키우기에 진심! 같이 쿠키 굽고 화분에 이름 붙이며 웃는 모습, 상상만 해도 따뜻하죠? 🪴🍪\n\n"
            "세 번째 힌트! 73번의 대화 중 절반이 밤 10시 이후… 잠들기 전, 서로에게 마지막 말을 남긴다면? 그건 그냥 친구 아니잖아요! 🌙📱\n\n"
            "네 번째 힌트! 요즘 둘 다 같은 드라마를 정주행 중이라는 소문도… 동시에 같은 장면에서 웃고 울었을지도요? 🎞️\n\n"
            '마지막 힌트! 느리지만 확실한 연결, 이 감정은 분명 특별한 무언가로 이어질 듯합니다. Stay Tuned!💌"}\n'
        )
        few_shot3 = (
            '{"title": "🔥 불꽃 튀는 케미?! ENTJ와 INFP의 아찔한 매칭!",\n'
            '"content": "첫 번째 힌트! 추진력 넘치는 ENTJ와 감성 깊은 INFP의 조합, '
            "이건 마치 불과 물의 만남 아닐까요? 서로를 자극하고 끌어주는 관계라면... 벌써부터 흥미진진해요! 🔥💧\n\n"
            "두 번째 힌트! 책 읽기와 혼자만의 시간, 그리고 여행을 좋아하는 두 사람! 혹시 같은 북토크에서 마주쳤을 수도?! 아니면 우연히 같은 목적지로 떠난 적도? 📚✈️\n\n"
            "세 번째 힌트! 총 91번의 대화, 그중 7번은 아침 출근 전?! 하루를 서로로 시작한다는 것, 꽤 의미 있는 신호 아닐까요? ☀️💬\n\n"
            "네 번째 힌트! 둘 다 '진심'과 '성장'을 중시하는 타입. 대화는 가벼워도, 마음은 깊게 연결되어 가는 중일지도 모르죠. 그리고 서로에게 배울 점이 많다는 점도 중요한 포인트! 🎯💭\n\n"
            '마지막 힌트! 이 조합, 조용히 타오르는 타입일지도요? 다음 챕터가 벌써 궁금해지는 두 사람의 이야기, Stay Tuned! 💌"}\n'
        )
    elif category == "FRIEND":
        # 친구
        style_guide = (
            "⚠️ FRIEND 카테고리에서는 절대 연애/썸/호감 표현을 하지 마세요. (우정 기반 연결만 허용)\n"
            "⚠️ FRIEND 유형에서는 하트 계열 이모지 사용 금지 "
            "✅친근한 뉴스 스타일\n"
            "✅호기심을 자극하는 어조\n"
            "✅청춘 드라마처럼 의리와 우정 내용으로 위트 있게\n"
            "✅독자에게 직접 말하듯 친근하게\n"
            "✅밝고 유쾌한 일상 톤\n"
            "✅소소한 유머와 편안한 말투\n"
        )
        few_shot1 = (
            '{"title": "📢 [속보] 누가 누구랑? 이번 주 새롭게 연결된 인연 공개!하지만… 누군지 바로 알려드릴 순 없죠😉",\n'
            '"content": "서로 다른 듯 닮은 두 사람이 연결됐어요! 지금부터 공개되는 힌트 3가지, 눈 크게 뜨고 확인하세요!💥💙\n\n'
            "첫 번째 힌트! INFJ와 ENFP, 감성과 열정의 충돌?!"
            "두 번째 힌트! 음악과 디지털 드로잉을 사랑하는 이들, 혹시 같은 콘서트에 있었던 건 아닐까요?! 🎧🎨\n\n"
            "첫 채팅에서 바로 TMI 파티일지도?!\\n\\n"
            "세 번째 힌트! 17번의 대화, 점점 깊어지는 관심! 첫 대화에선 고양이 얘기, 지금은 미래 얘기까지?! 🐱💬\n\n"
            '튜닝에서 소울메이트 찾기! 감성 충만한 이 튜너들... Stay Tuned!"}\n'
        )
        few_shot2 = (
            '{"title": "🎨 그림으로 이어진 만남, 혹시 소울메이트?",\n'
            '"content": "첫 번째 힌트! INFP와 ENFJ, 감성과 배려의 조합이 만들어낸 조용한 시너지! 🎨💬\\n\\n'
            "두 번째 힌트! 둘 다 그림과 산책을 좋아한다고 해요. 혹시 같은 미술관에서 만났던 건 아닐까요? 🖌️🌿\\n\\n"
            "세 번째 힌트! 반려동물을 좋아하는 사람들 ! 반려 용품 정보 공유로 더 가까워질 수도...!\\n\\n"
            "제가 분석한 결과, 두 분 ... 영혼의 소울메이트 맞죠? 📺📝\\n\\n"
            '소소하지만 진심 가득한 우정, 이 연결은 앞으로도 계속될 예정! Stay Tuned!"}\n'
        )

        few_shot3 = (
            '{"title": "🎙️ 토론하다 절친된 사이?! ENFP와 ENTJ의 케미 폭발!🔥",\n'
            '"content": "첫 번째 힌트! 열정의 화신 ENFP와 전략가 ENTJ, 만나자마자 대화가 폭발했다는 소문! 서로의 말에 끊임없이 리액션하며 쉴 틈 없는 대화, 상상 되시나요? 🎤, '
            "두 번째 힌트! 둘 다 리더십 있는 활동을 좋아하고, 주말마다 새로운 프로젝트 아이디어를 공유한다고요?! 혹시 비밀리에 동아리 만들고 있는 중? 📚🚀\n\n"
            "세 번째 힌트! 68번의 대화,‘끝장 토론’이었다고! 주제는 심지어 ‘어떻게 세상을 바꿀까?’였다는 후문도… 🌍🔥\n\n"
            "네 번째 힌트! 관심사는 넷플릭스 다큐, 스피치 대회, 그리고 글쓰기! 이 정도면 친구라기보단 서로의 브레인 자극제 아닐까요? 🧠💡\n\n"
            '마지막 힌트! 유쾌하고도 날카로운 이 두 사람, 앞으로 어떤 환상의 시너지를 보여줄지 기대되지 않나요? Stay Tuned!"}\n'
        )
    else:
        # 기본
        style_guide = (
            "- 가볍고 유쾌한 뉴스 스타일\n"
            "- 이모지 적절히 활용\n"
            "- 명료한 정보 전달 + 유머 섞기\n"
        )
        few_shot1 = (
            '{"title": "📚 관심사 케미 작렬! 이 조합, 기대해도 좋을까?",\n'
            '"content": "첫 번째 힌트! INTJ와 INFP의 만남, 차분한 전략가와 감성 충만 조용러의 만남?! 뭔가 진지한 토론이 벌어질 예감?! 🤓🎨\\n\\n'
            "두 번째 힌트! 둘 다 독서, 명상, 그리고 글쓰기를 좋아한다고? 같은 북카페에 앉아 있었을지도 몰라요! 📖☕\\n\\n"
            "세 번째 힌트! 환상의 짝궁끼리 깊은 얘기, 지금도 이어지고 있을지도... 🌙💬\\n\\n"
            '마지막 힌트! 이 케미, 우정일까? 단지, 스터디 메이트일까? 🍂🌈 응원하고 싶은 연결... Stay Tuned!"}'
        )

        few_shot2 = (
            '{"title": "🎨 그림으로 이어진 만남, 혹시 소울메이트?",\n'
            '"content": "첫 번째 힌트! INFP와 ENFJ, 감성과 배려의 조합이 만들어낸 조용한 시너지! 🎨💬\\n\\n'
            "두 번째 힌트! 둘 다 그림과 산책을 좋아한다고 해요. 혹시 같은 미술관에서 만났던 건 아닐까요? 🖌️🌿\\n\\n"
            "세 번째 힌트! 반려동물을 좋아하는 사람들 ! 반려 용품 정보 공유로 더 가까워질 수도...!\\n\\n"
            "제가 분석한 결과, 두 분 ... 영혼의 소울메이트 맞죠? 📺📝\\n\\n"
            '소소하지만 진심 가득한 우정, 이 연결은 앞으로도 계속될 예정! Stay Tuned!"}\n'
        )

        few_shot3 = (
            '{"title": "🎙️ 토론하다 절친된 사이?! ENFP와 ENTJ의 케미 폭발!🔥",\n'
            '"content": "첫 번째 힌트! 열정의 화신 ENFP와 전략가 ENTJ, 만나자마자 대화가 폭발했다는 소문! 서로의 말에 끊임없이 리액션하며 쉴 틈 없는 대화, 상상 되시나요? 🎤, '
            "두 번째 힌트! 둘 다 리더십 있는 활동을 좋아하고, 주말마다 새로운 프로젝트 아이디어를 공유한다고요?! 혹시 비밀리에 동아리 만들고 있는 중? 📚🚀\n\n"
            "세 번째 힌트! 68번의 대화,‘끝장 토론’이었다고! 주제는 심지어 ‘어떻게 세상을 바꿀까?’였다는 후문도… 🌍\n\n"
            "네 번째 힌트! 관심사는 넷플릭스 다큐, 스피치 대회, 그리고 글쓰기! 이 정도면 친구라기보단 서로의 브레인 자극제 아닐까요? 🧠💡\n\n"
            '마지막 힌트! 유쾌하고도 날카로운 이 두 사람, 앞으로 어떤 환상의 시너지를 보여줄지 기대되지 않나요? Stay Tuned! 🎯 "}\n'
        )
    few_shots = [
        "## 예시 1\n" + few_shot1,
        "## 예시 2\n" + few_shot2,
        "## 예시 3\n" + few_shot3,
    ]

    few_shot = "\n\n".join(few_shots)

    return (
        f"[매칭 유형: {category}]\n\n"
        f" 대화를 주고 받은 횟수: {chatCount}\n"
        f"{format_user(userA, '사용자 A')}\n\n"
        f"{format_user(userB, '사용자 B')}\n\n"
        "다음 기준을 바탕으로 **한국어 공지문**을 마크다운 내용으로 JSON에 담아 작성해주세요:\n\n"
        "제목과 본문을 JSON 형식으로 작성하고, 그 외 내용은 절대 포함하지 마세요.\n\n"
        "공지문 본문은 다음과 같이 5단계 구조로 **사용자 정보를 기반**으로 논리적으로 전개해주세요:\n"
        "1. **도입부**: 익명의 두 사람이 연결된 상황을 유쾌하게 소개 및 호기심 자극\n"
        "2. **MBTI 조합 해석**: 두 사람의 MBTI 성격 차이나 조합을 현실적인 비유와 함께 표현\n"
        "3. **공통 관심사 상상**: 그들의 관심사나 취미를 기반으로 어떤 공통점과 상호 보완적 관계가 있는지 유추\n"
        "4. **대화 기반 관계 해석**: 대화 횟수를 활용해 두 사람 사이에 쌓여가는 관계를 예쁘게 포장\n"
        "5. **마무리**: 다음을 기대하게 만드는 `Stay Tuned!` 문구로 마무리하세요.\n\n"
        "📌 반드시 현실 기반 묘사로 작성해주세요. 허구적 존재(요정, 마법, 판타지)는 금지입니다.\n"
        "유쾌하지만 의미를 알 수 없는 비유나 과장된 은유,추측은 금지\n"
        "이모지는 각 문단에 1~2개 정도로 제한해주세요.\n"
        "## 스타일 가이드\n"
        f"{style_guide}\n\n"
        "아래는 참고용 예시입니다. 유사한 구조와 어조로 작성해주세요.\n"
        f"{few_shot}\n"
    )
